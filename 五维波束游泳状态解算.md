# 五维波束游泳状态解算方法

## 1. 问题描述

本方法旨在解决一个典型的“反演问题”：当我们通过五维波束声呐获得了对同一个水下目标（如鱿鱼）的5个同步目标强度（TS）测量值后，如何利用这些数据反向推断出该目标最可能的游泳状态，即其**方向角（Yaw, `ψ`）**和**倾斜角（Tilt, `τ`）**。

- **输入**: 一组实测数据 `TS_obs = {TS_N, TS_S, TS_W, TS_E, TS_V}`。
- **输出**: 最优的游泳状态估计 `State(ψ, τ)`，以及可选的置信度或概率分布。

## 2. 模型构建所需的数据

所有解算方法的基础，都是一个能够描述“**从状态到观测**”过程的正向模型。您需要通过模拟来生成一个数据集，这个数据集将作为我们解算时用于对比的“理论模型”或“查找表”。

### 所需数据核心：一个包含随机性的查找表（LUT）

您需要创建一个多维查找表，其维度为 `(yaw, tilt, beam)`。表中的每一个单元格不仅是一个单一的TS值，而是一个**TS值的概率分布**，这个分布体现了由于波束宽度等因素造成的不确定性。

#### 数据生成步骤：

1.  **定义状态空间**：离散化所有可能的鱿鱼姿态。
    *   `yaw` (`ψ`): 例如，从 0° 到 359°，步长 1°。
    *   `tilt` (`τ`): 例如，从 -90° 到 +90°，步长 1°。

2.  **为每个状态进行蒙特卡洛模拟**：
    *   遍历状态空间中的每一个 `State(ψ, τ)` 组合。
    *   对于固定的 `(ψ, τ)`，进行 N 次（例如 N=1000）独立的微观模拟：
        a.  根据 `(ψ, τ)` 计算出5个波束的“理想”中心入射角 `θ_ideal`。**这里 `θ_ideal` 采用本项目统一的 `[-90°, +90°]` 定义（+90°为头部入射，-90°为尾部入射，0°为垂直入射）。**
        b.  为这5个 `θ_ideal` 分别加上一个随机扰动 `ε`，得到 `θ_final = θ_ideal + ε`。这个 `ε` 从一个代表波束方向图不确定性的PDF中抽样（例如，均值为0，标准差与3.5°相关的正态分布）。
        c.  根据 `θ_final` 和一个合适的TS物理模型（如KRM模型），计算出5个TS值。**请注意，如果所用的TS物理模型要求 `[0°, 180°]` 范围的入射角作为输入，则需要在此步骤进行适当的转换（例如，将 `[-90°, +90°]` 转换为 `[0°, 180°]`，使 `+90°` 变为 `0°`，`-90°` 变为 `180°`，`0°` 变为 `90°`）。**
    *   完成N次循环后，对于 `State(ψ, τ)`，您会得到5组、每组N个TS值的样本。

3.  **提取统计特征并存储**：
    *   遍历所有 `State(ψ, τ)`，将上一步得到的5组TS样本进行处理，并存入您的查找表。
    *   **对于方法一（卡方）**：您需要计算并存储每组样本的**均值 `μ`** 和**标准差 `σ`**。最终数据结构为：`LUT(ψ, τ) -> {μ_N, σ_N, μ_S, σ_S, ...}`。
    *   **对于方法二/三（最大似然/贝叶斯）**：您需要存储能代表整个**概率密度函数（PDF）**的信息。这可以是：
        *   **参数化存储**：如果假设TS分布为正态分布，那么存储均值和标准差即可。
        *   **非参数化存储**：存储每个分布的直方图或一个核密度估计（KDE）对象。

## 3. 解算方法

### 方法一：卡方（Chi-Squared）最小化

**核心思想**：寻找一个理论状态，使其产生的TS期望值与您的实测值最“接近”。

**步骤**：
1.  从查找表中获取每个 `State(ψ, τ)` 对应的5个TS均值 `μ_k` 和标准差 `σ_k`。
2.  遍历所有 `(ψ, τ)`，计算卡方统计量 `χ²`：
    
    `χ²(ψ, τ) = Σ [ (TS_k_obs - μ_k(ψ, τ)) / σ_k(ψ, τ) ]²`  (k = N, S, W, E, V)
    
3.  **`χ²` 值最小**的那个 `State(ψ, τ)` 就是最可能的游泳状态。

### 方法二：最大似然估计 (Maximum Likelihood Estimation, MLE)

**核心思想**：寻找一个理论状态，使得“出现您这组实测数据”的概率最大。

**步骤**：
1.  从查找表中获取每个 `State(ψ, τ)` 对应的5个TS概率密度函数 `P(TS | ψ, τ)`。
2.  遍历所有 `(ψ, τ)`，计算似然函数 `L` 的值（通常取对数以方便计算）：

    `log L(ψ, τ) = Σ log( P(TS_k_obs | ψ, τ) )` (k = N, S, W, E, V)

3.  **`log L` 值最大**的那个 `State(ψ, τ)` 就是最优解。

### 方法三：贝叶斯推断 (Bayesian Inference)

**核心思想**：不仅找到最优解，还得到所有可能解的概率分布，从而量化结果的不确定性。

**步骤**：
1.  **计算似然度 `L`**：同方法二。
2.  **定义先验概率 `P(ψ, τ)`**：这是您对鱿鱼姿态的先验知识。例如，根据论文，您可以构建一个以 `-17.7°` 为中心的倾斜角先验分布。如果没有先验知识，可使用均匀分布。
3.  **计算后验概率 `P_post`**：
    
    `log P_post(ψ, τ) ∝ log L(ψ, τ) + log P(ψ, τ)`
    
4.  **分析后验分布**：您会得到一个覆盖所有 `(ψ, τ)` 的二维后验概率分布图。
    *   **最优解**：是这个概率分布图的峰值点。
    *   **不确定性**：是这个峰的“胖瘦”程度。

## 4. 实施建议

1.  **从方法一开始**：卡方最小化最容易实现，且通常能提供很好的初步结果。
2.  **数据是关键**：解算结果的准确性高度依赖于您在第2节中构建的查找表（即正向模型）的质量。一个精确的TS物理模型和合理的波束角不确定性模型至关重要。
3.  **逐步求精**：在实现了卡方方法后，可以进一步尝试最大似然估计，以获得更精确的结果。贝叶斯推断则能提供最全面的信息，是最终的理想目标。
